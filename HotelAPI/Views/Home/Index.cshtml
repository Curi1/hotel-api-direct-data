@{
    ViewData["Title"] = "Home Page";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel SPA</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<!-- Botão para abrir o modal de cadastro -->
<button type="button" class="btn btn-success my-4" data-bs-toggle="modal" data-bs-target="#registerModal">
    Cadastre-se
</button>

<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registerModalLabel">Cadastro de Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="mb-3">
                        <label for="nome" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="nome" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="telefone" class="form-label">Telefone</label>
                        <input type="text" class="form-control" id="telefone">
                    </div>
                    <button type="submit" class="btn btn-primary">Cadastrar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Reserva -->
<div class="modal fade" id="reservaModal" tabindex="-1" aria-labelledby="reservaModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reservaModalLabel">Fazer Reserva</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="reservaForm">
          <div class="mb-3">
            <input type="hidden" id="reservaQuartoId" name="quartoId">
            <label for="reservaStatusId" class="form-label">Status da Reserva</label>
            <select class="form-control" id="reservaStatusId">
              <option value="1">Reservado</option>
              <option value="2">Confirmado</option>
              <option value="3">Cancelado</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="reservaDataEntrada" class="form-label">Data de Entrada</label>
            <input type="date" class="form-control" id="reservaDataEntrada" required>
          </div>
          <div class="mb-3">
            <label for="reservaDataSaida" class="form-label">Data de Saída</label>
            <input type="date" class="form-control" id="reservaDataSaida" required>
          </div>
          <button type="submit" class="btn btn-primary">Confirmar Reserva</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="container mt-5">
    <h2>Quartos Disponíveis</h2>
    <div id="quartosList" class="row">
        <!-- Quartos serão injetados aqui via AJAX -->
    </div>
</div>

<script>
    $(document).ready(function() {
        function loadQuartos() {
            $.ajax({
                url: '/api/quarto',
                type: 'GET',
                success: function(quartos) {
                    $('#quartosList').empty();
                    quartos.forEach(quarto => {
                        $('#quartosList').append(
                            `<div class="col-md-4 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">${quarto.tipo}</h5>
                                        <p class="card-text">Número: ${quarto.numero}</p>
                                        <p class="card-text">Preço: R$${quarto.preco.toFixed(2)}</p>
                                        <button class="btn btn-primary btn-reservar" data-quarto-id="${quarto.quartoId}">Reservar</button>
                                    </div>
                                </div>
                            </div>`
                        );
                    });
                },
                error: function() {
                    alert('Erro ao carregar quartos.');
                }
            });
        }

        $('#registerForm').submit(function(e) {
            e.preventDefault();
            const cliente = {
                nome: $('#nome').val(),
                email: $('#email').val(),
                telefone: $('#telefone').val()
            };

            $.ajax({
                url: '/api/cliente',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(cliente),
                success: function(response) {
                    alert('Cadastro realizado com sucesso!');
                    localStorage.setItem('ClienteId', response.clienteId);
                    $('#registerModal').modal('hide');
                },
                error: function() {
                    alert('Erro ao cadastrar cliente.');
                }
            });
        });

        $('#quartosList').on('click', '.btn-reservar', function() {
            const quartoId = $(this).data('quarto-id');
            $('#reservaQuartoId').val(quartoId);
            $('#reservaModal').modal('show');
        });

        $('#reservaForm').submit(function(e) {
            e.preventDefault();
            const reserva = {
                clienteId: localStorage.getItem('ClienteId'),
                quartoId: $('#reservaQuartoId').val(),
                reservaStatusId: $('#reservaStatusId').val(),
                dataEntrada: $('#reservaDataEntrada').val(),
                dataSaida: $('#reservaDataSaida').val()
            };

            $.ajax({
                url: '/api/reserva',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(reserva),
                success: function() {
                    alert('Reserva realizada com sucesso!');
                    $('#reservaModal').modal('hide');
                    loadQuartos(); // Atualizar lista de quartos
                },
                error: function() {
                    alert('Erro ao realizar a reserva.');
                }
            });
        });

        loadQuartos(); // Carregar quartos ao iniciar
    });
</script>

</body>
</html>
